'use strict';

var fs = require('fs');
var path = require('path');

var itchy = require('itchy/legacy');
var currify = require('currify/legacy');

var addDir = currify(function (dir, name) {
    return path.join(dir, name);
});

module.exports = function (dir, from, to, fn) {
    check(dir, from, to, fn);
    
    if (from.length !== to.length)
        { return fn(Error('Names lengths mismatch')); }
    
    var namesFrom = from.map(addDir(dir));
    var namesTo = to.map(addDir(dir));
    
    itchy(namesFrom, rename(namesTo), fn);
};

function rename(namesTo) {
    var i = -1;
    
    return function (name, fn) {
        fs.rename(name, namesTo[++i], fn);
    };
}


function check(dir, from, to, fn) {
    if (typeof dir !== 'string')
        { throw Error('dir should be a string!'); }
    
    if (!Array.isArray(from))
        { throw Error('from should be an array!'); }
    
    if (!Array.isArray(to))
        { throw Error('to should be an array!'); }
    
    if (typeof fn !== 'function')
        { throw Error('fn should be a function!'); }
}

