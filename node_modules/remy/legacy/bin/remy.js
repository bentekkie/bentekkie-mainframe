#!/usr/bin/env node


'use strict';

var remy = require('..');
var glob = require('glob');
var args = process.argv.slice(2);
var arg = args[0];

if (/^-(v|-version)$/.test(arg)) version();else if (!arg || /^-(h|-help)$/.test(arg)) help();else glob(arg, function (error, files) {
    var name = files[0];

    if (!name) error = Error('file not found');

    if (error) return console.error(error.message);

    main(name);
});

function main(name) {
    var rm = remy(name);

    rm.on('error', function (error, name) {
        console.error(name, ':', error.message);
        rm.continue();
    });

    rm.on('progress', function (percent) {
        console.log(percent + '%');
    });

    rm.on('end', function () {
        console.log('Done.');
    });
}

function version() {
    console.log('v' + info().version);
}

function info() {
    return require('../package');
}

function help() {
    var bin = require('../json/bin');
    var usage = 'Usage: ' + info().name + ' [path]';

    console.log(usage);
    console.log('Options:');

    Object.keys(bin).forEach(function (name) {
        var line = '  ' + name + ' ' + bin[name];
        console.log(line);
    });
}