{"version":3,"file":null,"sources":["../node_modules/emitify/lib/emitify.js","../client/index.js","../node_modules/load.js/load.js"],"sourcesContent":["'use strict';\n\nmodule.exports = Emitify;\n\nfunction Emitify() {\n    if (this instanceof Emitify)\n        this._all = {};\n    else\n        return new Emitify();\n}\n\nEmitify.prototype._check = function(event, callback) {\n    var isTwo = arguments.length === 2;\n    \n    if (typeof event !== 'string')\n        throw Error('event should be string!');\n    \n    if (isTwo && typeof callback !== 'function')\n        throw Error('callback should be function!');\n};\n\nEmitify.prototype.on   = function(event, callback) {\n    var funcs = this._all[event];\n    \n    this._check(event, callback);\n    \n    if (funcs)\n        funcs.push(callback);\n    else\n        this._all[event] = [callback];\n    \n    return this;\n};\n\nEmitify.prototype.addListener =\nEmitify.prototype.on;\n\nEmitify.prototype.once  = function(event, callback) {\n    var self = this;\n    \n    self._check(event, callback);\n    \n    self.on(event, function fn() {\n        callback.apply(null, arguments);\n        self.off(event, fn);\n    });\n    \n    return this;\n};\n\nEmitify.prototype.off   = function(event, callback) {\n    var events  = this._all[event] || [],\n        index   = events.indexOf(callback);\n    \n    this._check(event, callback);\n    \n    while (~index) {\n        events.splice(index, 1);\n        index = events.indexOf(callback);\n    }\n    \n    return this;\n};\n\nEmitify.prototype.removeListener    =\nEmitify.prototype.off;\n\nEmitify.prototype.emit = function(event) {\n    var args    = [].slice.call(arguments, 1),\n        funcs   = this._all[event];\n    \n    this._check(event);\n    \n    if (funcs)\n        funcs.forEach(function(fn) {\n            fn.apply(null, args);\n        });\n    else if (event === 'error')\n        throw args[0];\n    \n    return this;\n};\n\nEmitify.prototype.removeAllListeners = function(event) {\n    this._check(event);\n    this._all[event] = [];\n    \n    return this;\n};\n\n","'use strict';\n\n/* global io */\n\nimport Emitify from 'emitify';\nimport {js as loadJs} from 'load.js';\n\nexport default (prefix, socketPath, callback) => {\n    if (!callback) {\n        if (!socketPath) {\n            callback    = prefix;\n            prefix      = '/salam';\n        } else {\n            callback    = socketPath;\n            socketPath  = '';\n        }\n    }\n    \n    socketPath += '/socket.io';\n    \n    loadSocket(prefix, () => {\n        init();\n        \n        if (typeof callback === 'function')\n            callback(Salam(prefix, socketPath));\n    });\n}\n\nfunction loadSocket(prefix, fn) {\n    if (window.io)\n        return fn();\n    \n    loadJs(`${prefix}/dist/socket.io.js`, fn);\n}\n\nfunction Salam(prefix, socketPath) {\n    if (!(this instanceof Salam))\n        return new Salam(prefix, socketPath);\n    \n    Emitify.call(this);\n    this._progress = ProgressProto(prefix, socketPath, this);\n}\n\nfunction init() {\n    Salam.prototype = Object.create(Emitify.prototype);\n    \n    Salam.prototype.pack = function(from, to, files) {\n        this._progress.pack(from, to, files);\n    };\n    \n    Salam.prototype.extract = function(from, to, files) {\n        this._progress.extract(from, to, files);\n    };\n    \n    Salam.prototype.abort = function() {\n        this._progress.abort();\n    };\n    \n    Salam.prototype.pause = function() {\n        this._progress.pause();\n    };\n    \n    Salam.prototype.continue   = function() {\n        this._progress.continue();\n    };\n}\n\nfunction ProgressProto(room, socketPath, salam) {\n    var socket,\n        href            = getHost(),\n        FIVE_SECONDS    = 5000;\n    \n    if (!(this instanceof ProgressProto))\n        return new ProgressProto(room, socketPath, salam);\n    \n    socket = io.connect(href + room, {\n        'max reconnection attempts' : Math.pow(2, 32),\n        'reconnection limit'        : FIVE_SECONDS,\n        path                        : socketPath\n    });\n    \n    salam.on('auth', (username, password) => {\n        socket.emit('auth', username, password);\n    });\n    \n    socket.on('accept', () => {\n        salam.emit('accept');\n    });\n    \n    socket.on('reject', () => {\n        salam.emit('reject');\n    });\n    \n    socket.on('err', (error) => {\n        salam.emit('error', error);\n    });\n    \n    socket.on('file', (name) => {\n        salam.emit('file', name);\n    });\n    \n    socket.on('progress', (percent) => {\n        salam.emit('progress', percent);\n    });\n    \n    socket.on('end', () => {\n        salam.emit('end');\n    });\n    \n    socket.on('connect', () => {\n        salam.emit('connect');\n    });\n    \n    socket.on('disconnect', () => {\n        salam.emit('disconnect');\n    });\n    \n    this.pause = () => {\n        socket.emit('pause');\n    };\n    \n    this.continue = () => {\n        socket.emit('continue');\n    };\n    \n    this.abort = () => {\n        socket.emit('abort');\n    };\n    \n    this.pack = (from, to, files) => {\n        socket.emit('pack', from, to, files);\n    };\n    \n    this.extract = (from, to) => {\n        socket.emit('extract', from, to);\n    };\n    \n    function getHost() {\n        const l = location;\n        const href = l.origin || l.protocol + '//' + l.host;\n        \n        return href;\n    }\n}\n\n","(function(global) {\n    'use strict';\n    \n    if (typeof module !== 'undefined' && module.exports)\n        module.exports  = new LoadProto();\n    else\n        global.load     = new LoadProto();\n    \n    function LoadProto() {\n        function load(src, callback) {\n            var ext = getExt(src);\n            \n            switch (ext) {\n            case '.js':\n                load.js(src, callback);\n                break;\n            \n            case '.css':\n                load.css(src, callback);\n                break;\n            \n            case '.json':\n                load.json(src, callback);\n                break;\n            \n            default:\n                load.ajax(src, callback);\n            }\n        }\n        \n        load.js     = function(src, callback) {\n            var id  = getIdBySrc(src),\n                el  = document.getElementById(id);\n            \n            if (el) {\n                callback();\n            } else {\n                el      = document.createElement('script');\n                el.id   = id;\n                el.src  = src;\n                \n                el.addEventListener('load', function(event) {\n                    callback(null, event);\n                });\n                \n                el.addEventListener('error', callback);\n            \n                document.body.appendChild(el);\n            }\n            \n            return el;\n        };\n        \n        load.css    = function(src, callback) {\n            var id  = getIdBySrc(src),\n                el  = document.getElementById(id);\n            \n            if (el) {\n                callback();\n            } else {\n                el      = document.createElement('link');\n                el.id   = getIdBySrc(src);\n                el.rel  = 'stylesheet';\n                el.href = src;\n                \n                el.addEventListener('load', function(event) {\n                    callback(null, event);\n                });\n                \n                el.addEventListener('error', callback);\n                \n                document.head.appendChild(el);\n            }\n            \n            return el;\n        };\n        \n        load.ajax   = function(url, callback) {\n            var request = new XMLHttpRequest();\n            \n            request.open('GET', url, true);\n            \n            request.addEventListener('load', function() {\n                var data;\n                \n                if (request.status >= 200 && request.status < 400){\n                    data = request.responseText;\n                    callback(null, data);\n                }\n            });\n            \n            request.addEventListener('error', callback);\n            \n            request.send();\n        };\n        \n        load.json   = function(url ,callback) {\n            load.ajax(url, function(error, data) {\n                var json;\n                \n                if (!error)\n                    json = JSON.parse(data);\n                \n                callback(error, json);\n            });\n        };\n        \n        load.series = function(urls, callback) {\n            var url = urls.shift();\n                \n            if (!url)\n                callback();\n            else\n                load(url, function(error) {\n                    if (error)\n                        callback(error);\n                    else\n                        load.series(urls, callback);\n                });\n        };\n        \n        load.parallel = function(urls, callback) {\n            var i       = urls.length,\n                done,\n                func    = function(error) {\n                    --i;\n                    \n                    if (!i && !done || error) {\n                        done = true;\n                        callback(error);\n                    }\n                };\n                \n            urls.forEach(function(url) {\n                load(url, func);\n            });\n        };\n        \n        function getExt(name) {\n            var ret     = '',\n                dot,\n                isStr   = typeof name === 'string';\n            \n            if (isStr) {\n                dot = name.lastIndexOf('.');\n                \n                if (~dot)\n                    ret = name.substr(dot);\n            }\n            \n            return ret;\n        }\n        \n        function getIdBySrc(src) {\n            var num, sub, id,\n                isStr       = typeof src === 'string';\n            \n            if (isStr) {\n                if (~src.indexOf(':'))\n                    src += '-join';\n                \n                num    = src.lastIndexOf('/') + 1;\n                sub    = src.substr(src, num);\n                id     = src.replace(sub, '')\n                            .replace(/\\./g, '-');\n            }\n            \n            return id;\n        } \n        \n        return load;\n    }\n})(this);\n"],"names":["Emitify","this","_all","loadSocket","prefix","fn","window","io","Salam","socketPath","call","_progress","ProgressProto","init","prototype","Object","create","pack","from","to","files","extract","abort","pause","continue","room","salam","getHost","l","location","href","origin","protocol","host","socket","FIVE_SECONDS","connect","Math","pow","on","username","password","emit","error","name","percent","_check","event","callback","isTwo","arguments","length","Error","funcs","push","addListener","once","self","apply","off","events","index","indexOf","splice","removeListener","args","slice","forEach","removeAllListeners","global","LoadProto","load","src","ext","getExt","js","css","json","ajax","dot","ret","isStr","lastIndexOf","substr","getIdBySrc","num","sub","id","replace","el","document","getElementById","createElement","addEventListener","body","appendChild","rel","head","url","request","XMLHttpRequest","open","data","status","responseText","send","JSON","parse","series","urls","shift","parallel","done","i","func","module","exports"],"mappings":"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"}