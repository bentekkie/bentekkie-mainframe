{"version":3,"file":"omnes.js","sources":["../node_modules/emitify/lib/emitify.js","../client/index.js","../node_modules/load.js/load.js"],"sourcesContent":["'use strict';\n\nmodule.exports = Emitify;\n\nfunction Emitify() {\n    if (this instanceof Emitify)\n        this._all = {};\n    else\n        return new Emitify();\n}\n\nEmitify.prototype._check = function(event, callback) {\n    var isTwo = arguments.length === 2;\n    \n    if (typeof event !== 'string')\n        throw Error('event should be string!');\n    \n    if (isTwo && typeof callback !== 'function')\n        throw Error('callback should be function!');\n};\n\nEmitify.prototype.on   = function(event, callback) {\n    var funcs = this._all[event];\n    \n    this._check(event, callback);\n    \n    if (funcs)\n        funcs.push(callback);\n    else\n        this._all[event] = [callback];\n    \n    return this;\n};\n\nEmitify.prototype.addListener =\nEmitify.prototype.on;\n\nEmitify.prototype.once  = function(event, callback) {\n    var self = this;\n    \n    self._check(event, callback);\n    \n    self.on(event, function fn() {\n        callback.apply(null, arguments);\n        self.off(event, fn);\n    });\n    \n    return this;\n};\n\nEmitify.prototype.off   = function(event, callback) {\n    var events  = this._all[event] || [],\n        index   = events.indexOf(callback);\n    \n    this._check(event, callback);\n    \n    while (~index) {\n        events.splice(index, 1);\n        index = events.indexOf(callback);\n    }\n    \n    return this;\n};\n\nEmitify.prototype.removeListener    =\nEmitify.prototype.off;\n\nEmitify.prototype.emit = function(event) {\n    var args    = [].slice.call(arguments, 1),\n        funcs   = this._all[event];\n    \n    this._check(event);\n    \n    if (funcs)\n        funcs.forEach(function(fn) {\n            fn.apply(null, args);\n        });\n    else if (event === 'error')\n        throw args[0];\n    \n    return this;\n};\n\nEmitify.prototype.removeAllListeners = function(event) {\n    this._check(event);\n    this._all[event] = [];\n    \n    return this;\n};\n\n","'use strict';\n\n/* global io */\n\nimport Emitify from 'emitify';\nimport {js as loadJs} from 'load.js';\n\nexport default (prefix, socketPath, callback) => {\n    if (!callback) {\n        if (!socketPath) {\n            callback    = prefix;\n            prefix      = '/omnes';\n        } else {\n            callback    = socketPath;\n            socketPath  = '';\n        }\n    }\n    \n    socketPath += '/socket.io';\n    \n    loadSocket(prefix, () => {\n        init();\n        \n        if (typeof callback === 'function')\n            callback(Omnes(prefix, socketPath));\n    });\n}\n\nfunction loadSocket(prefix, fn) {\n    if (window.io)\n        return fn();\n    \n    loadJs(`${prefix}/dist/socket.io.js`, fn);\n}\n\nfunction Omnes(prefix, socketPath) {\n    if (!(this instanceof Omnes))\n        return new Omnes(prefix, socketPath);\n    \n    Emitify.call(this);\n    this._progress = ProgressProto(prefix, socketPath, this);\n}\n\nfunction init() {\n    Omnes.prototype = Object.create(Emitify.prototype);\n    \n    Omnes.prototype.extract = function(from, to) {\n        this._progress.extract(from, to);\n    };\n}\n\nfunction ProgressProto(room, socketPath, omnes) {\n    const href = getHost();\n    const FIVE_SECONDS = 5000;\n    \n    if (!(this instanceof ProgressProto))\n        return new ProgressProto(room, socketPath, omnes);\n    \n    const socket = io.connect(href + room, {\n        'max reconnection attempts' : Math.pow(2, 32),\n        'reconnection limit'        : FIVE_SECONDS,\n        path                        : socketPath\n    });\n    \n    omnes.on('auth', (username, password) => {\n        socket.emit('auth', username, password);\n    });\n    \n    socket.on('accept', () => {\n        omnes.emit('accept');\n    });\n    \n    socket.on('reject', () => {\n        omnes.emit('reject');\n    });\n    \n    socket.on('err', (error) => {\n        omnes.emit('error', error);\n    });\n    \n    socket.on('file', (name) => {\n        omnes.emit('file', name);\n    });\n    \n    socket.on('progress', (percent) => {\n        omnes.emit('progress', percent);\n    });\n    \n    socket.on('end', () => {\n        omnes.emit('end');\n    });\n    \n    socket.on('connect', () => {\n        omnes.emit('connect');\n    });\n    \n    socket.on('disconnect', () => {\n        omnes.emit('disconnect');\n    });\n    \n    this.abort = () => {\n        socket.emit('abort');\n    };\n    \n    this.extract = (from, to) => {\n        socket.emit('extract', from, to);\n    };\n    \n    function getHost() {\n        const l = location;\n        const href = l.origin || l.protocol + '//' + l.host;\n        \n        return href;\n    }\n}\n\n","(function(global) {\n    'use strict';\n    \n    if (typeof module !== 'undefined' && module.exports)\n        module.exports  = new LoadProto();\n    else\n        global.load     = new LoadProto();\n    \n    function LoadProto() {\n        function load(src, callback) {\n            var ext = getExt(src);\n            \n            switch (ext) {\n            case '.js':\n                load.js(src, callback);\n                break;\n            \n            case '.css':\n                load.css(src, callback);\n                break;\n            \n            case '.json':\n                load.json(src, callback);\n                break;\n            \n            default:\n                load.ajax(src, callback);\n            }\n        }\n        \n        load.js     = function(src, callback) {\n            var id  = getIdBySrc(src),\n                el  = document.getElementById(id);\n            \n            if (el) {\n                callback();\n            } else {\n                el      = document.createElement('script');\n                el.id   = id;\n                el.src  = src;\n                \n                el.addEventListener('load', function(event) {\n                    callback(null, event);\n                });\n                \n                el.addEventListener('error', callback);\n            \n                document.body.appendChild(el);\n            }\n            \n            return el;\n        };\n        \n        load.css    = function(src, callback) {\n            var id  = getIdBySrc(src),\n                el  = document.getElementById(id);\n            \n            if (el) {\n                callback();\n            } else {\n                el      = document.createElement('link');\n                el.id   = getIdBySrc(src);\n                el.rel  = 'stylesheet';\n                el.href = src;\n                \n                el.addEventListener('load', function(event) {\n                    callback(null, event);\n                });\n                \n                el.addEventListener('error', callback);\n                \n                document.head.appendChild(el);\n            }\n            \n            return el;\n        };\n        \n        load.ajax   = function(url, callback) {\n            var request = new XMLHttpRequest();\n            \n            request.open('GET', url, true);\n            \n            request.addEventListener('load', function() {\n                var data;\n                \n                if (request.status >= 200 && request.status < 400){\n                    data = request.responseText;\n                    callback(null, data);\n                }\n            });\n            \n            request.addEventListener('error', callback);\n            \n            request.send();\n        };\n        \n        load.json   = function(url ,callback) {\n            load.ajax(url, function(error, data) {\n                var json;\n                \n                if (!error)\n                    json = JSON.parse(data);\n                \n                callback(error, json);\n            });\n        };\n        \n        load.series = function(urls, callback) {\n            var url = urls.shift();\n                \n            if (!url)\n                callback();\n            else\n                load(url, function(error) {\n                    if (error)\n                        callback(error);\n                    else\n                        load.series(urls, callback);\n                });\n        };\n        \n        load.parallel = function(urls, callback) {\n            var i       = urls.length,\n                done,\n                func    = function(error) {\n                    --i;\n                    \n                    if (!i && !done || error) {\n                        done = true;\n                        callback(error);\n                    }\n                };\n                \n            urls.forEach(function(url) {\n                load(url, func);\n            });\n        };\n        \n        function getExt(name) {\n            var ret     = '',\n                dot,\n                isStr   = typeof name === 'string';\n            \n            if (isStr) {\n                dot = name.lastIndexOf('.');\n                \n                if (~dot)\n                    ret = name.substr(dot);\n            }\n            \n            return ret;\n        }\n        \n        function getIdBySrc(src) {\n            var num, sub, id,\n                isStr       = typeof src === 'string';\n            \n            if (isStr) {\n                if (~src.indexOf(':'))\n                    src += '-join';\n                \n                num    = src.lastIndexOf('/') + 1;\n                sub    = src.substr(src, num);\n                id     = src.replace(sub, '')\n                            .replace(/\\./g, '-');\n            }\n            \n            return id;\n        } \n        \n        return load;\n    }\n})(this);\n"],"names":["Emitify","this","_all","loadSocket","prefix","fn","window","io","Omnes","socketPath","call","_progress","ProgressProto","init","prototype","Object","create","extract","from","to","room","omnes","getHost","l","location","href","origin","protocol","host","FIVE_SECONDS","socket","connect","Math","pow","on","username","password","emit","error","name","percent","abort","_check","event","callback","isTwo","arguments","length","Error","funcs","push","addListener","once","self","apply","off","events","index","indexOf","splice","removeListener","args","slice","forEach","removeAllListeners","global","LoadProto","load","src","ext","getExt","js","css","json","ajax","dot","ret","isStr","lastIndexOf","substr","getIdBySrc","num","sub","id","replace","el","document","getElementById","createElement","addEventListener","body","appendChild","rel","head","url","request","XMLHttpRequest","open","data","status","responseText","send","JSON","parse","series","urls","shift","parallel","done","i","func","module","exports"],"mappings":"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"}